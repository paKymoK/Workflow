eureka:
  client:
    service-url:
      defaultZone: ${EUREKA_URI:http://127.0.0.1:8761/eureka}
server:
  port: 8080
spring:
  main:
    web-application-type: reactive
  application:
     name: gateway-service
  data:
    redis:
      port: 6379
      host: 127.0.0.1
  security:
    oauth2:
      client:
        registration:
          gateway-service-oidc:
            provider: gateway-service
            client-id: gateway
            client-secret: gateway-secret
            authorization-grant-type: authorization_code
            redirect-uri: "http://127.0.0.1:8080/login/oauth2/code/{registrationId}"
            scope: openid
            client-name: gateway-service-oidc
        provider:
          gateway-service:
            issuer-uri: http://127.0.0.1:9000
      resourceserver:
        jwt:
          issuer-uri: http://127.0.0.1:9000
  cloud:
    gateway:
      server:
        webflux:
          enabled: true
          httpclient:
            connect-timeout: 10000
            response-timeout: 30s
            compression: false
          routes:
            - id: ticket-sse-route
              uri: lb://workflow-service
              predicates:
                - Path=/workflow-service/v1/ticket/stream/**
                - Method=GET
              filters:
                - name: PreserveHostHeader
                - name: RemoveResponseHeader
                  args:
                    name: Transfer-Encoding
                - RewritePath=/workflow-service/(?<segment>.*), /workflow/${segment}
              metadata:
                response-timeout: 1800000
                connect-timeout: 60000
            - id: workflow-websocket
              uri: lb:ws://workflow-service
              predicates:
                - Path=/workflow-service/web-socket/**
              filters:
                - RewritePath=/workflow-service/(?<segment>.*), /workflow/${segment}
            - id: workflow
              uri: lb://workflow-service
              predicates:
                - Path=/workflow-service/**
              filters:
                - RewritePath=/workflow-service/(?<segment>.*), /workflow/${segment}

logging:
  level:
    root: INFO
    org.springframework.web: INFO
    org.springframework.security: INFO
    org.springframework.security.oauth2: DEBUG
